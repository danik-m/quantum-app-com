import streamlit as st
import numpy as np
import matplotlib.pyplot as plt
from scipy import constants

# --- –ö–û–ù–°–¢–ê–ù–¢–ò ---
G = constants.G  # –ì—Ä–∞–≤—ñ—Ç–∞—Ü—ñ–π–Ω–∞ —Å—Ç–∞–ª–∞
M_EARTH = 5.972e24  # –ú–∞—Å–∞ –ó–µ–º–ª—ñ (–∫–≥)
R_EARTH = 6371e3    # –†–∞–¥—ñ—É—Å –ó–µ–º–ª—ñ (–º)
C = constants.c     # –®–≤–∏–¥–∫—ñ—Å—Ç—å —Å–≤—ñ—Ç–ª–∞ (–º/—Å)

# --- –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø –°–¢–û–†–Ü–ù–ö–ò ---
st.set_page_config(
    page_title="–ì—Ä–∞–≤—ñ—Ç–∞—Ü—ñ–π–Ω–µ —á–µ—Ä–≤–æ–Ω–µ –∑–º—ñ—â–µ–Ω–Ω—è —Ç–∞ GPS",
    layout="wide",
    initial_sidebar_state="expanded"
)

# --- –§–£–ù–ö–¶–Ü–á –†–û–ó–†–ê–•–£–ù–ö–£ ---

def gravitational_potential(mass, radius):
    """–ü–æ—Ç–µ–Ω—Ü—ñ–∞–ª –≥—Ä–∞–≤—ñ—Ç–∞—Ü—ñ–π–Ω–æ–≥–æ –ø–æ–ª—è: phi = -GM/r"""
    return -G * mass / radius

def calculate_time_dilation(time_interval, mass, r_ground, r_orbit, v_orbit):
    """
    –†–æ–∑—Ä–∞—Ö–æ–≤—É—î —Ä—ñ–∑–Ω–∏—Ü—é –≤ –ø–ª–∏–Ω—ñ —á–∞—Å—É –Ω–∞ –æ—Å–Ω–æ–≤—ñ –ó–†–¢ —Ç–∞ –°–†–¢.
    –ü–æ–≤–µ—Ä—Ç–∞—î: (delta_GR, delta_SR, delta_total) –≤ —Å–µ–∫—É–Ω–¥–∞—Ö.
    """
    # 1. –ì—Ä–∞–≤—ñ—Ç–∞—Ü—ñ–π–Ω–∏–π –µ—Ñ–µ–∫—Ç (–ó–†–¢)
    # –§–æ—Ä–º—É–ª–∞ –∑ –ª–µ–∫—Ü—ñ—ó: dt_sat = dt_earth * (1 + (phi_earth - phi_sat)/c^2)
    # –ê–ª–µ –æ—Å–∫—ñ–ª—å–∫–∏ phi –≤—ñ–¥'—î–º–Ω–µ, –∞ r_sat > r_earth, —Ç–æ phi_sat > phi_earth.
    # –†—ñ–∑–Ω–∏—Ü—è –ø–æ—Ç–µ–Ω—Ü—ñ–∞–ª—ñ–≤ (phi_sat - phi_earth) > 0, —á–∞—Å –π–¥–µ —à–≤–∏–¥—à–µ.
    
    phi_ground = gravitational_potential(mass, r_ground)
    phi_orbit = gravitational_potential(mass, r_orbit)
    
    # –†–æ–∑–∫–ª–∞–¥–∞–Ω–Ω—è –≤ —Ä—è–¥ –¢–µ–π–ª–æ—Ä–∞ (—è–∫ —É –ª–µ–∫—Ü—ñ—ó):
    # dt1 * (1 + |phi1|/c^2) = dt2 * (1 + |phi2|/c^2)
    # dt_orbit approx dt_ground * (1 + (|phi_ground| - |phi_orbit|)/c^2)
    
    factor_gr = (np.abs(phi_ground) - np.abs(phi_orbit)) / C**2
    delta_gr = time_interval * factor_gr

    # 2. –ö—ñ–Ω–µ–º–∞—Ç–∏—á–Ω–∏–π –µ—Ñ–µ–∫—Ç (–°–†–¢)
    # –ß–∞—Å –Ω–∞ —Å—É–ø—É—Ç–Ω–∏–∫—É —Å–ø–æ–≤—ñ–ª—å–Ω—é—î—Ç—å—Å—è —á–µ—Ä–µ–∑ —à–≤–∏–¥–∫—ñ—Å—Ç—å.
    # factor_sr approx -v^2 / (2c^2)
    factor_sr = -(v_orbit**2) / (2 * C**2)
    delta_sr = time_interval * factor_sr

    # –°—É–º–∞—Ä–Ω–∏–π –µ—Ñ–µ–∫—Ç
    delta_total = delta_gr + delta_sr
    
    return delta_gr, delta_sr, delta_total

# --- –Ü–ù–¢–ï–†–§–ï–ô–° ---

st.title("üåå –°–∏–º—É–ª—è—Ü—ñ—è: –ì—Ä–∞–≤—ñ—Ç–∞—Ü—ñ–π–Ω–µ —Å–ø–æ–≤—ñ–ª—å–Ω–µ–Ω–Ω—è —á–∞—Å—É —Ç–∞ GPS")
st.markdown("""
–¶–µ–π –¥–æ–¥–∞—Ç–æ–∫ —Å–∏–º—É–ª—é—î –µ—Ñ–µ–∫—Ç–∏ **–ó–∞–≥–∞–ª—å–Ω–æ—ó —Ç–µ–æ—Ä—ñ—ó –≤—ñ–¥–Ω–æ—Å–Ω–æ—Å—Ç—ñ (–ó–†–¢)** —Ç–∞ **–°–ø–µ—Ü—ñ–∞–ª—å–Ω–æ—ó —Ç–µ–æ—Ä—ñ—ó –≤—ñ–¥–Ω–æ—Å–Ω–æ—Å—Ç—ñ (–°–†–¢)**, 
–æ–ø–∏—Å–∞–Ω—ñ –≤ –ª–µ–∫—Ü—ñ—ó. –ú–∏ —Ä–æ–∑–≥–ª—è–Ω–µ–º–æ, —è–∫ –≥—Ä–∞–≤—ñ—Ç–∞—Ü—ñ—è —Ç–∞ —à–≤–∏–¥–∫—ñ—Å—Ç—å –≤–ø–ª–∏–≤–∞—é—Ç—å –Ω–∞ –ø–ª–∏–Ω —á–∞—Å—É –¥–ª—è —Å—É–ø—É—Ç–Ω–∏–∫—ñ–≤ –Ω–∞–≤—ñ–≥–∞—Ü—ñ—ó.
""")

# --- –ë–û–ö–û–í–ê –ü–ê–ù–ï–õ–¨ ---
st.sidebar.header("‚öôÔ∏è –ü–∞—Ä–∞–º–µ—Ç—Ä–∏ –°–∏–º—É–ª—è—Ü—ñ—ó")

sim_mode = st.sidebar.selectbox("–†–µ–∂–∏–º:", ["GPS (–ó–µ–º–ª—è)", "–ß–æ—Ä–Ω–∞ –¥—ñ—Ä–∞ / –ï–∫—Å—Ç—Ä–∏–º", "–í–ª–∞—Å–Ω—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏"])

if sim_mode == "GPS (–ó–µ–º–ª—è)":
    mass = M_EARTH
    radius_planet = R_EARTH
    height_orbit = st.sidebar.slider("–í–∏—Å–æ—Ç–∞ –æ—Ä–±—ñ—Ç–∏ —Å—É–ø—É—Ç–Ω–∏–∫–∞ (–∫–º)", 200, 36000, 20200) * 1000
    # –î–ª—è GPS —à–≤–∏–¥–∫—ñ—Å—Ç—å –±–ª–∏–∑—å–∫–æ 3.87 –∫–º/—Å (14000 –∫–º/–≥–æ–¥)
    # –†–æ–∑—Ä–∞—Ö—É—î–º–æ –æ—Ä–±—ñ—Ç–∞–ª—å–Ω—É —à–≤–∏–¥–∫—ñ—Å—Ç—å –¥–ª—è –∫–æ–ª–æ–≤–æ—ó –æ—Ä–±—ñ—Ç–∏: v = sqrt(GM/r)
    v_orbit_calc = np.sqrt(G * mass / (radius_planet + height_orbit))
    velocity = st.sidebar.number_input("–®–≤–∏–¥–∫—ñ—Å—Ç—å —Å—É–ø—É—Ç–Ω–∏–∫–∞ (–º/—Å)", value=float(round(v_orbit_calc)), step=100.0)
    duration_hours = st.sidebar.slider("–¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—É (–≥–æ–¥–∏–Ω)", 1, 48, 24)

elif sim_mode == "–ß–æ—Ä–Ω–∞ –¥—ñ—Ä–∞ / –ï–∫—Å—Ç—Ä–∏–º":
    mass = st.sidebar.number_input("–ú–∞—Å–∞ –æ–±'—î–∫—Ç–∞ (–º–∞—Å–∏ –°–æ–Ω—Ü—è)", 1.0, 100.0, 10.0) * 1.989e30
    radius_planet = st.sidebar.number_input("–†–∞–¥—ñ—É—Å –ø–æ–¥—ñ—ó (–∫–º)", 10, 1000, 30) * 1000
    height_orbit = st.sidebar.number_input("–í–∏—Å–æ—Ç–∞ –æ—Ä–±—ñ—Ç–∏ (–∫–º)", 100, 1000000, 10000) * 1000
    velocity = st.sidebar.number_input("–®–≤–∏–¥–∫—ñ—Å—Ç—å –Ω–∞ –æ—Ä–±—ñ—Ç—ñ (–∫–º/—Å)", 0.0, 300000.0, 10000.0) * 1000
    duration_hours = st.sidebar.number_input("–¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å (–≥–æ–¥–∏–Ω)", 1, 1000, 24)

else: # –í–ª–∞—Å–Ω—ñ
    mass = st.sidebar.number_input("–ú–∞—Å–∞ –ø–ª–∞–Ω–µ—Ç–∏ (–∫–≥)", value=M_EARTH, format="%.2e")
    radius_planet = st.sidebar.number_input("–†–∞–¥—ñ—É—Å –ø–ª–∞–Ω–µ—Ç–∏ (–º)", value=R_EARTH, format="%.2e")
    height_orbit = st.sidebar.number_input("–í–∏—Å–æ—Ç–∞ –æ—Ä–±—ñ—Ç–∏ (–º)", value=20200000.0, format="%.2e")
    velocity = st.sidebar.number_input("–®–≤–∏–¥–∫—ñ—Å—Ç—å —Å—É–ø—É—Ç–Ω–∏–∫–∞ (–º/—Å)", value=3874.0)
    duration_hours = st.sidebar.number_input("–¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å (–≥–æ–¥–∏–Ω)", value=24)

# --- –†–û–ó–†–ê–•–£–ù–ö–ò ---
r_ground = radius_planet
r_orbit = radius_planet + height_orbit
time_interval_sec = duration_hours * 3600

delta_gr, delta_sr, delta_total = calculate_time_dilation(
    time_interval_sec, mass, r_ground, r_orbit, velocity
)

# –ü–µ—Ä–µ–≤–µ–¥–µ–Ω–Ω—è –≤ –º—ñ–∫—Ä–æ—Å–µ–∫—É–Ω–¥–∏
us_gr = delta_gr * 1e6
us_sr = delta_sr * 1e6
us_total = delta_total * 1e6

# –ü–æ—Ö–∏–±–∫–∞ –≤—ñ–¥—Å—Ç–∞–Ω—ñ (—Å–≤—ñ—Ç–ª–æ –ø—Ä–æ—Ö–æ–¥–∏—Ç—å –≤—ñ–¥—Å—Ç–∞–Ω—å –∑–∞ —Ü–µ–π —á–∞—Å)
dist_error = np.abs(delta_total) * C

# --- –í–Ü–î–û–ë–†–ê–ñ–ï–ù–ù–Ø –†–ï–ó–£–õ–¨–¢–ê–¢–Ü–í ---
col1, col2 = st.columns([2, 1])

with col1:
    st.subheader("üìä –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –†–æ–∑—Ä–∞—Ö—É–Ω–∫—É")
    
    st.info(f"**–ü–∞—Ä–∞–º–µ—Ç—Ä–∏:** –í–∏—Å–æ—Ç–∞: {height_orbit/1000:.0f} –∫–º | –ß–∞—Å —Å–ø–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω–Ω—è: {duration_hours} –≥–æ–¥.")

    # –ö–∞—Ä—Ç–∫–∏ –∑ –º–µ—Ç—Ä–∏–∫–∞–º–∏
    m1, m2, m3 = st.columns(3)
    m1.metric("–ì—Ä–∞–≤—ñ—Ç–∞—Ü—ñ–π–Ω–∏–π –µ—Ñ–µ–∫—Ç (–ó–†–¢)", f"{us_gr:.2f} –º–∫—Å", help="–ß–∞—Å –Ω–∞ —Å—É–ø—É—Ç–Ω–∏–∫—É –π–¥–µ –®–í–ò–î–®–ï, –±–æ –≥—Ä–∞–≤—ñ—Ç–∞—Ü—ñ—è —Å–ª–∞–±—à–∞.")
    m2.metric("–ï—Ñ–µ–∫—Ç —à–≤–∏–¥–∫–æ—Å—Ç—ñ (–°–†–¢)", f"{us_sr:.2f} –º–∫—Å", help="–ß–∞—Å –Ω–∞ —Å—É–ø—É—Ç–Ω–∏–∫—É –π–¥–µ –ü–û–í–Ü–õ–¨–ù–Ü–®–ï, –±–æ –≤—ñ–Ω —Ä—É—Ö–∞—î—Ç—å—Å—è.")
    m3.metric("–°—É–º–∞—Ä–Ω–∏–π –∑—Å—É–≤", f"{us_total:.2f} –º–∫—Å", delta_color="off")

    st.error(f"üõë **–ü–æ—Ö–∏–±–∫–∞ –Ω–∞–≤—ñ–≥–∞—Ü—ñ—ó (—è–∫—â–æ –Ω–µ –≤—Ä–∞—Ö—É–≤–∞—Ç–∏):** {dist_error/1000:.2f} –∫–º")

    # –ì—Ä–∞—Ñ—ñ–∫
    fig, ax = plt.subplots(figsize=(8, 4))
    categories = ['–ó–†–¢ (–ì—Ä–∞–≤—ñ—Ç–∞—Ü—ñ—è)', '–°–†–¢ (–®–≤–∏–¥–∫—ñ—Å—Ç—å)', '–°—É–º–∞']
    values = [us_gr, us_sr, us_total]
    colors = ['green', 'red', 'blue']
    
    bars = ax.bar(categories, values, color=colors)
    ax.axhline(0, color='black', linewidth=0.8)
    ax.set_ylabel("–ó—Å—É–≤ —á–∞—Å—É (–º—ñ–∫—Ä–æ—Å–µ–∫—É–Ω–¥–∏)")
    ax.set_title(f"–°–∫–ª–∞–¥–æ–≤—ñ —Ä–æ–∑—Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó –∑–∞ {duration_hours} –≥–æ–¥")
    
    # –î–æ–¥–∞–≤–∞–Ω–Ω—è –∑–Ω–∞—á–µ–Ω—å –Ω–∞ —Å—Ç–æ–≤–ø—á–∏–∫–∏
    for bar in bars:
        yval = bar.get_height()
        ax.text(bar.get_x() + bar.get_width()/2, yval, f'{yval:.1f}', va='bottom' if yval > 0 else 'top', ha='center')
        
    st.pyplot(fig)

with col2:
    st.subheader("üî≠ –°—Ö–µ–º–∞ –ï–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—É")
    # –ü—Ä–æ—Å—Ç–∞ —Å—Ö–µ–º–∞
    fig_scheme, ax_s = plt.subplots(figsize=(5, 5))
    earth = plt.Circle((0, 0), 1, color='blue', alpha=0.3, label='–ü–ª–∞–Ω–µ—Ç–∞')
    orbit_radius = r_orbit / r_ground
    orbit = plt.Circle((0, 0), orbit_radius, color='gray', fill=False, linestyle='--')
    
    sat_x = orbit_radius
    sat = plt.Circle((sat_x, 0), 0.1, color='red', label='–°—É–ø—É—Ç–Ω–∏–∫')
    obs = plt.Circle((1, 0), 0.1, color='green', label='–°–ø–æ—Å—Ç–µ—Ä—ñ–≥–∞—á')
    
    ax_s.add_patch(earth)
    ax_s.add_patch(orbit)
    ax_s.add_patch(sat)
    ax_s.add_patch(obs)
    
    ax_s.set_xlim(-orbit_radius - 1, orbit_radius + 1)
    ax_s.set_ylim(-orbit_radius - 1, orbit_radius + 1)
    ax_s.set_aspect('equal')
    ax_s.axis('off')
    ax_s.legend(loc='lower right')
    ax_s.text(0, 0, "M", ha='center', va='center')
    
    st.pyplot(fig_scheme)
    st.caption("–ú–∞—Å—à—Ç–∞–± —Ä–∞–¥—ñ—É—Å—ñ–≤ –∑–±–µ—Ä–µ–∂–µ–Ω–æ –≤—ñ–¥–Ω–æ—Å–Ω–æ R_–ø–ª–∞–Ω–µ—Ç–∏")


# --- –î–ï–¢–ê–õ–¨–ù–ï –†–Ü–®–ï–ù–ù–Ø (EXPANDER) ---
st.divider()
with st.expander("üìö –î–ï–¢–ê–õ–¨–ù–ï –ú–ê–¢–ï–ú–ê–¢–ò–ß–ù–ï –†–Ü–®–ï–ù–ù–Ø (–Ø–∫ —É –ª–µ–∫—Ü—ñ—ó)", expanded=True):
    st.markdown(r"""
    ### 1. –ü—Ä–∏–Ω—Ü–∏–ø –ï–∫–≤—ñ–≤–∞–ª–µ–Ω—Ç–Ω–æ—Å—Ç—ñ —Ç–∞ –í—ñ–ª—å–Ω–æ –ü–∞–¥–∞—é—á–∏–π –°–ø–æ—Å—Ç–µ—Ä—ñ–≥–∞—á
    
    –ó–≥—ñ–¥–Ω–æ –∑ –ª–µ–∫—Ü—ñ—î—é, –º–∏ –Ω–µ –º–æ–∂–µ–º–æ –≤—ñ–¥—Ä—ñ–∑–Ω–∏—Ç–∏ —Å–∏–ª—É –≥—Ä–∞–≤—ñ—Ç–∞—Ü—ñ—ó –≤—ñ–¥ —Å–∏–ª–∏ —ñ–Ω–µ—Ä—Ü—ñ—ó. 
    –©–æ–± –ø–æ—Ä—ñ–≤–Ω—è—Ç–∏ –ø–ª–∏–Ω —á–∞—Å—É –≤ —Ç–æ—á—Ü—ñ 1 (–Ω–∞ –≤–∏—Å–æ—Ç—ñ $R_1$) —Ç–∞ –≤ —Ç–æ—á—Ü—ñ 2 (–Ω–∞ –≤–∏—Å–æ—Ç—ñ $R_2$), –º–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –¥–æ–ø–æ–º—ñ–∂–Ω–æ–≥–æ —Å–ø–æ—Å—Ç–µ—Ä—ñ–≥–∞—á–∞ $S'$, —è–∫–∏–π –≤—ñ–ª—å–Ω–æ –ø–∞–¥–∞—î –∑ –Ω–µ—Å–∫—ñ–Ω—á–µ–Ω–Ω–æ—Å—Ç—ñ.
    
    –°–∏—Å—Ç–µ–º–∞ –≤—ñ–¥–ª—ñ–∫—É –≤—ñ–ª—å–Ω–æ –ø–∞–¥–∞—é—á–æ–≥–æ —Å–ø–æ—Å—Ç–µ—Ä—ñ–≥–∞—á–∞ —î **–ª–æ–∫–∞–ª—å–Ω–æ —ñ–Ω–µ—Ä—Ü—ñ–∞–ª—å–Ω–æ—é**. –£ –Ω—ñ–π –¥—ñ—é—Ç—å –∑–∞–∫–æ–Ω–∏ –°–ø–µ—Ü—ñ–∞–ª—å–Ω–æ—ó –¢–µ–æ—Ä—ñ—ó –í—ñ–¥–Ω–æ—Å–Ω–æ—Å—Ç—ñ (–°–†–¢).
    
    ### 2. –ó–∞–∫–æ–Ω –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –ï–Ω–µ—Ä–≥—ñ—ó
    
    –î–ª—è —Å–ø–æ—Å—Ç–µ—Ä—ñ–≥–∞—á–∞, —â–æ –ø–∞–¥–∞—î –∑ –Ω–µ—Å–∫—ñ–Ω—á–µ–Ω–Ω–æ—Å—Ç—ñ (–¥–µ $v=0$) –Ω–∞ –ø–ª–∞–Ω–µ—Ç—É –º–∞—Å–∏ $M$, –∑–∞–∫–æ–Ω –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –µ–Ω–µ—Ä–≥—ñ—ó (–≤ –Ω—å—é—Ç–æ–Ω—ñ–≤—Å—å–∫–æ–º—É –Ω–∞–±–ª–∏–∂–µ–Ω–Ω—ñ –¥–ª—è —Å–ª–∞–±–∫–æ–≥–æ –ø–æ–ª—è):
    
    $$ \frac{mv^2}{2} - G\frac{mM}{r} = 0 $$
    
    –ó–≤—ñ–¥—Å–∏ —à–≤–∏–¥–∫—ñ—Å—Ç—å –≤—ñ–ª—å–Ω–æ–≥–æ –ø–∞–¥—ñ–Ω–Ω—è –≤ —Ç–æ—á—Ü—ñ $r$:
    $$ v = \sqrt{\frac{2GM}{r}} $$
    
    –ê–±–æ, –≤–∏—Ä–∞–∂–∞—é—á–∏ —á–µ—Ä–µ–∑ –≥—Ä–∞–≤—ñ—Ç–∞—Ü—ñ–π–Ω–∏–π –ø–æ—Ç–µ–Ω—Ü—ñ–∞–ª $\phi = -\frac{GM}{r}$:
    $$ v = \sqrt{2|\phi|} $$
    
    ### 3. –ó–≤'—è–∑–æ–∫ —á–∞—Å—ñ–≤ —á–µ—Ä–µ–∑ –õ–æ—Ä–µ–Ω—Ü-—Ñ–∞–∫—Ç–æ—Ä
    
    –ù–µ—Ö–∞–π –ø–∞–¥–∞—é—á–∏–π —Å–ø–æ—Å—Ç–µ—Ä—ñ–≥–∞—á $S'$ –ø—Ä–æ–ª—ñ—Ç–∞—î –ø–æ–≤–∑ –Ω–µ—Ä—É—Ö–æ–º–æ–≥–æ —Å–ø–æ—Å—Ç–µ—Ä—ñ–≥–∞—á–∞ –≤ —Ç–æ—á—Ü—ñ 1 –∑—ñ —à–≤–∏–¥–∫—ñ—Å—Ç—é $v_1$.
    –ó–∞ —Ñ–æ—Ä–º—É–ª–æ—é —É–ø–æ–≤—ñ–ª—å–Ω–µ–Ω–Ω—è —á–∞—Å—É –°–†–¢:
    $$ dt' = dt_1 \sqrt{1 - \frac{v_1^2}{c^2}} $$
    
    –ê–Ω–∞–ª–æ–≥—ñ—á–Ω–æ, –ø—Ä–æ–ª—ñ—Ç–∞—é—á–∏ –ø–æ–≤–∑ —Ç–æ—á–∫—É 2 –∑—ñ —à–≤–∏–¥–∫—ñ—Å—Ç—é $v_2$:
    $$ dt' = dt_2 \sqrt{1 - \frac{v_2^2}{c^2}} $$
    
    –û—Å–∫—ñ–ª—å–∫–∏ $dt'$ (–≤–ª–∞—Å–Ω–∏–π —á–∞—Å –ø–∞–¥–∞—é—á–æ–≥–æ —Å–ø–æ—Å—Ç–µ—Ä—ñ–≥–∞—á–∞) –æ–¥–Ω–∞–∫–æ–≤–∏–π –¥–ª—è –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è —ñ–Ω—Ç–µ—Ä–≤–∞–ª—ñ–≤, –ø—Ä–∏—Ä—ñ–≤–Ω—é—î–º–æ:
    $$ dt_1 \sqrt{1 - \frac{v_1^2}{c^2}} = dt_2 \sqrt{1 - \frac{v_2^2}{c^2}} $$
    
    ### 4. –ù–∞–±–ª–∏–∂–µ–Ω–Ω—è —Å–ª–∞–±–∫–æ–≥–æ –ø–æ–ª—è
    
    –û—Å–∫—ñ–ª—å–∫–∏ $v \ll c$ (–¥–ª—è –ó–µ–º–ª—ñ –¥—Ä—É–≥–∞ –∫–æ—Å–º—ñ—á–Ω–∞ $\approx 11$ –∫–º/—Å, $c \approx 300000$ –∫–º/—Å), —Ä–æ–∑–∫–ª–∞–¥–∞—î–º–æ –≤ —Ä—è–¥ –¢–µ–π–ª–æ—Ä–∞ $(1-x)^{1/2} \approx 1 - x/2$:
    
    $$ dt_1 \left(1 - \frac{v_1^2}{2c^2}\right) \approx dt_2 \left(1 - \frac{v_2^2}{2c^2}\right) $$
    
    –ü—ñ–¥—Å—Ç–∞–≤–ª—è—î–º–æ $v^2 = 2|\phi|$:
    
    $$ dt_1 \left(1 - \frac{|\phi_1|}{c^2}\right) \approx dt_2 \left(1 - \frac{|\phi_2|}{c^2}\right) $$
    
    –í—Ä–∞—Ö–æ–≤—É—é—á–∏, —â–æ $\phi$ ‚Äî –≤—ñ–¥'—î–º–Ω–∞ –≤–µ–ª–∏—á–∏–Ω–∞, –ø–µ—Ä–µ–ø–∏—à–µ–º–æ —á–µ—Ä–µ–∑ –ø–æ—Ç–µ–Ω—Ü—ñ–∞–ª–∏:
    
    $$ dt_2 \approx dt_1 \frac{1 + \phi_1/c^2}{1 + \phi_2/c^2} \approx dt_1 \left(1 + \frac{\phi_1 - \phi_2}{c^2}\right) $$
    
    ### 5. –ó–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –¥–æ GPS
    
    **–¢–æ—á–∫–∞ 1 (–ó–µ–º–ª—è):** $\phi_1 = -\frac{GM}{R}$
    **–¢–æ—á–∫–∞ 2 (–°—É–ø—É—Ç–Ω–∏–∫):** $\phi_2 = -\frac{GM}{R+h}$
    
    –û—Å–∫—ñ–ª—å–∫–∏ $R+h > R$, —Ç–æ $|\phi_2| < |\phi_1|$, —Ç–æ–±—Ç–æ –ø–æ—Ç–µ–Ω—Ü—ñ–∞–ª –Ω–∞ –æ—Ä–±—ñ—Ç—ñ *–≤–∏—â–∏–π* (–º–µ–Ω—à –≤—ñ–¥'—î–º–Ω–∏–π). 
    –†—ñ–∑–Ω–∏—Ü—è $\Delta \phi = \phi_2 - \phi_1 > 0$.
    
    –¶–µ –æ–∑–Ω–∞—á–∞—î, —â–æ $dt_2 > dt_1$. **–ß–∞—Å –Ω–∞ —Å—É–ø—É—Ç–Ω–∏–∫—É –π–¥–µ —à–≤–∏–¥—à–µ.**
    
    –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –¥–ª—è –¥–æ–±–∏ ($T = 86400$ —Å):
    $$ \Delta t_{GR} = T \cdot \frac{GM}{c^2} \left(\frac{1}{R} - \frac{1}{R+h}\right) \approx 45.7 \mu s $$
    
    ### 6. –ü–æ–ø—Ä–∞–≤–∫–∞ –°–†–¢ (—à–≤–∏–¥–∫—ñ—Å—Ç—å —Å—É–ø—É—Ç–Ω–∏–∫–∞)
    
    –°—É–ø—É—Ç–Ω–∏–∫ –Ω–µ –≤–∏—Å–∏—Ç—å –Ω–∞ –º—ñ—Å—Ü—ñ, –∞ —Ä—É—Ö–∞—î—Ç—å—Å—è –ø–æ –æ—Ä–±—ñ—Ç—ñ –∑—ñ —à–≤–∏–¥–∫—ñ—Å—Ç—é $v_{orb}$. –ó–≥—ñ–¥–Ω–æ –°–†–¢, —Ü–µ —É–ø–æ–≤—ñ–ª—å–Ω—é—î —á–∞—Å:
    $$ \Delta t_{SR} \approx -T \frac{v_{orb}^2}{2c^2} \approx -7.2 \mu s $$
    
    ### 7. –§—ñ–Ω–∞–ª—å–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    
    $$ \Delta t_{total} = \Delta t_{GR} + \Delta t_{SR} \approx 45.7 - 7.2 = 38.5 \mu s $$
    
    –ó–∞ –æ–¥–Ω—É –¥–æ–±—É –≥–æ–¥–∏–Ω–Ω–∏–∫ —Å—É–ø—É—Ç–Ω–∏–∫–∞ –π–¥–µ –≤–ø–µ—Ä–µ–¥ –Ω–∞ **38.5 –º—ñ–∫—Ä–æ—Å–µ–∫—É–Ω–¥**. 
    –ü–æ—Ö–∏–±–∫–∞ –≤—ñ–¥—Å—Ç–∞–Ω—ñ: $\Delta x = c \cdot \Delta t \approx 300000 \text{ –∫–º/—Å} \cdot 38.5 \cdot 10^{-6} \text{ —Å} \approx 11.55 \text{ –∫–º}$.
    """)